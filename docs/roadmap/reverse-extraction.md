# ì—­ë°©í–¥ ìŠ¤í™ ì¶”ì¶œ (Reverse Spec Extraction) ê³„íš

> **ë¬¸ì„œ ìƒíƒœ**: ê³„íš ë‹¨ê³„ (ë¯¸êµ¬í˜„)
> **ì‘ì„±ì¼**: 2024-12-24
> **ëª©ì **: ë ˆê±°ì‹œ/ê¸°ì¡´ í”„ë¡œì íŠ¸ì— SDD ë„ì…ì„ ìœ„í•œ ì½”ë“œ â†’ ìŠ¤í™ ì—­ì¶”ì¶œ ê¸°ëŠ¥
> **í•µì‹¬ ì „ëµ**: Serena MCP í™œìš©ìœ¼ë¡œ ê°œë°œ ë‚œì´ë„ ëŒ€í­ ê°ì†Œ

---

## í•µì‹¬ ì „ëµ: Serena MCP í™œìš©

### Serenaë€?

[Serena](https://github.com/oraios/serena)ëŠ” ì½”ë“œ ë¶„ì„ì„ ìœ„í•œ MCP ì„œë²„ë¡œ:

```
âœ… 30ê°œ+ ì–¸ì–´ ì§€ì› (Python, TS, Java, Go, Rust, C++ ë“±)
âœ… ì‹¬ë³¼ ìˆ˜ì¤€ ì½”ë“œ ì¶”ì¶œ (í´ë˜ìŠ¤, í•¨ìˆ˜, ë³€ìˆ˜)
âœ… ì°¸ì¡°/ì˜ì¡´ì„± ê´€ê³„ ë¶„ì„
âœ… IDE ìˆ˜ì¤€ì˜ ì‹œë§¨í‹± ë¶„ì„
âœ… Claude Code/Desktop ë„¤ì´í‹°ë¸Œ í†µí•©
```

### ì™œ Serenaì¸ê°€?

**ì§ì ‘ êµ¬í˜„ vs Serena í™œìš© ë¹„êµ**:

| í•­ëª© | ì§ì ‘ êµ¬í˜„ | Serena í™œìš© |
|------|----------|-------------|
| **AST íŒŒì„œ ê°œë°œ** | ì–¸ì–´ë³„ ê°œë³„ êµ¬í˜„ í•„ìš” | âŒ ë¶ˆí•„ìš” |
| **ì§€ì› ì–¸ì–´** | TS/JSë§Œ (ì´ˆê¸°) | 30ê°œ+ ì¦‰ì‹œ |
| **ì‹¬ë³¼ ì¶”ì¶œ** | ts-morph ë“± ì§ì ‘ | `find_symbol` API |
| **ì°¸ì¡° ë¶„ì„** | ì§ì ‘ êµ¬í˜„ | `find_referencing_symbols` |
| **ê°œë°œ ê¸°ê°„** | ìˆ˜ê°œì›” | ìˆ˜ì£¼ |
| **ìœ ì§€ë³´ìˆ˜** | ì–¸ì–´ë³„ ì—…ë°ì´íŠ¸ í•„ìš” | Serenaê°€ ë‹´ë‹¹ |

**ê²°ë¡ **: ì§ì ‘ íŒŒì„œ êµ¬í˜„ ëŒ€ì‹  Serena MCPì— ìœ„ì„

### ì•„í‚¤í…ì²˜ ë³€ê²½

```
ê¸°ì¡´ ê³„íš:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scanner    â”‚â”€â”€â”€â”€â–¶â”‚  AST Parser â”‚â”€â”€â”€â”€â–¶â”‚  Analyzer   â”‚
â”‚  (ì§ì ‘êµ¬í˜„) â”‚     â”‚  (ì§ì ‘êµ¬í˜„) â”‚     â”‚  (ì§ì ‘êµ¬í˜„) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                 â†“                   â†“
     ê°œë°œ ë‚œì´ë„: ë†’ìŒ, ì–¸ì–´ë³„ êµ¬í˜„ í•„ìš”

ë³€ê²½ëœ ê³„íš:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scanner    â”‚â”€â”€â”€â”€â–¶â”‚ Serena MCP  â”‚â”€â”€â”€â”€â–¶â”‚  Analyzer   â”‚
â”‚  (ê°„ë‹¨)     â”‚     â”‚  (ì™¸ë¶€)     â”‚     â”‚  (ì§‘ì¤‘)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                 â†“                   â†“
     íŒŒì¼ëª©ë¡ë§Œ        ì‹¬ë³¼/ì°¸ì¡° ì¶”ì¶œ      ìŠ¤í™ ìƒì„±ì— ì§‘ì¤‘
```

### Serena MCP í™œìš© ë°©ì‹

**1. MCP í´ë¼ì´ì–¸íŠ¸ë¡œ í†µí•©**:

```typescript
// src/core/reverse/serena-client.ts
import { Client } from '@anthropic/mcp';

class SerenaClient {
  private mcp: Client;

  async findSymbol(query: string): Promise<Symbol[]> {
    return this.mcp.callTool('find_symbol', { query });
  }

  async findReferences(symbol: string): Promise<Reference[]> {
    return this.mcp.callTool('find_referencing_symbols', { symbol });
  }

  async getSymbolDefinition(symbol: string): Promise<Definition> {
    return this.mcp.callTool('get_symbol_definition', { symbol });
  }
}
```

**2. ë˜ëŠ” Claude Code ì„¸ì…˜ì—ì„œ ì§ì ‘ í™œìš©**:

```bash
# Claude Codeì—ì„œ Serena MCP ì„¤ì • í›„
sdd reverse extract --use-mcp serena
```

Claudeê°€ Serena ë„êµ¬ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì—¬ ë¶„ì„ ìˆ˜í–‰.

### ì—­í•  ë¶„ë‹´

| ì—­í•  | ë‹´ë‹¹ | ë¹„ê³  |
|------|------|------|
| **íŒŒì¼ ìŠ¤ìº”** | SDD Tool | ë””ë ‰í† ë¦¬ íŠ¸ë¦¬, íŒŒì¼ ëª©ë¡ |
| **ì‹¬ë³¼ ì¶”ì¶œ** | Serena | find_symbol |
| **ì°¸ì¡° ë¶„ì„** | Serena | find_referencing_symbols |
| **ì˜ì¡´ì„± ê·¸ë˜í”„** | Serena + SDD | Serena ë°ì´í„° ê°€ê³µ |
| **ìŠ¤í™ ìƒì„±** | SDD Tool | í…œí”Œë¦¿, í¬ë§·íŒ… |
| **AI ì˜ë„ ì¶”ë¡ ** | Claude | í”„ë¡¬í”„íŠ¸ ê¸°ë°˜ |
| **ê²€í†  ì›Œí¬í”Œë¡œìš°** | SDD Tool | CLI ì¸í„°ë™ì…˜ |

---

## ë°°ê²½ ë° ë™ê¸°

### í˜„ì¬ ë¬¸ì œ

```
SDD ë„ì…ì˜ ê°€ì¥ í° ì¥ë²½:
"ì´ë¯¸ ì½”ë“œê°€ ìˆëŠ”ë°, ìŠ¤í™ì„ ì²˜ìŒë¶€í„° ë‹¤ ì‘ì„±í•´ì•¼ í•˜ë‚˜ìš”?"

í˜„ì‹¤:
- ë ˆê±°ì‹œ í”„ë¡œì íŠ¸ì— ìŠ¤í™ ë¬¸ì„œ ì—†ìŒ
- ìˆ˜ë™ìœ¼ë¡œ ìŠ¤í™ ì‘ì„± = ë§‰ëŒ€í•œ ì´ˆê¸° ë¹„ìš©
- ë¹„ìš© ë•Œë¬¸ì— SDD ë„ì… í¬ê¸°
```

### í•´ê²° ë°©í–¥

```
ì½”ë“œ â†’ ìŠ¤í™ ì—­ì¶”ì¶œ ìë™í™”
"ê¸°ì¡´ ì½”ë“œë¥¼ ë¶„ì„í•´ì„œ ìŠ¤í™ ì´ˆì•ˆì„ ìë™ ìƒì„±"

íš¨ê³¼:
- SDD ë„ì… ì¥ë²½ ëŒ€í­ ê°ì†Œ
- ë ˆê±°ì‹œ í”„ë¡œì íŠ¸ë„ ì ì§„ì  SDD ì „í™˜ ê°€ëŠ¥
- "ë¬¸ì„œí™” ë¶€ì±„" í•´ì†Œ
```

---

## ê¸°ëŠ¥ ê°œìš”

### ëª…ë ¹ì–´ êµ¬ì¡°

```bash
# ì „ì²´ í”„ë¡œì íŠ¸ ë¶„ì„
sdd reverse scan                    # ì½”ë“œë² ì´ìŠ¤ ìŠ¤ìº”
sdd reverse extract                 # ìŠ¤í™ ì´ˆì•ˆ ìƒì„±
sdd reverse review                  # ìƒì„±ëœ ìŠ¤í™ ê²€í† /ìˆ˜ì •

# íŠ¹ì • ëª¨ë“ˆ/íŒŒì¼ ëŒ€ìƒ
sdd reverse extract src/auth/       # ë””ë ‰í† ë¦¬ ë‹¨ìœ„
sdd reverse extract src/auth/AuthService.ts  # íŒŒì¼ ë‹¨ìœ„

# ì˜µì…˜
sdd reverse extract --depth shallow # ì–•ì€ ë¶„ì„ (ë¹ ë¦„)
sdd reverse extract --depth deep    # ê¹Šì€ ë¶„ì„ (ì •í™•)
sdd reverse extract --ai            # AI ë³´ì¡° ë¶„ì„
sdd reverse extract --dry-run       # ë¯¸ë¦¬ë³´ê¸°ë§Œ
```

### ì¶œë ¥ë¬¼

```
ì…ë ¥: ê¸°ì¡´ ì½”ë“œë² ì´ìŠ¤
      src/
      â”œâ”€â”€ auth/
      â”‚   â”œâ”€â”€ AuthService.ts
      â”‚   â”œâ”€â”€ LoginController.ts
      â”‚   â””â”€â”€ TokenRepository.ts
      â””â”€â”€ order/
          â”œâ”€â”€ OrderService.ts
          â””â”€â”€ PaymentAdapter.ts

ì¶œë ¥: ìŠ¤í™ ì´ˆì•ˆ (ê²€í†  í•„ìš”)
      .sdd/
      â”œâ”€â”€ domains.yml
      â””â”€â”€ specs/
          â”œâ”€â”€ auth/
          â”‚   â”œâ”€â”€ domain.md
          â”‚   â”œâ”€â”€ user-authentication/
          â”‚   â”‚   â”œâ”€â”€ spec.md (ì´ˆì•ˆ)
          â”‚   â”‚   â””â”€â”€ .reverse-meta.json
          â”‚   â””â”€â”€ token-management/
          â”‚       â””â”€â”€ spec.md (ì´ˆì•ˆ)
          â””â”€â”€ order/
              â”œâ”€â”€ domain.md
              â””â”€â”€ order-processing/
                  â””â”€â”€ spec.md (ì´ˆì•ˆ)
```

---

## ì¶”ì¶œ ë ˆë²¨ ì •ì˜

### Level 1: êµ¬ì¡° ì¶”ì¶œ (Structure)

```
ì¶”ì¶œ ëŒ€ìƒ:
- ë””ë ‰í† ë¦¬ êµ¬ì¡° â†’ ë„ë©”ì¸ êµ¬ì¡°
- íŒŒì¼/í´ë˜ìŠ¤ â†’ ê¸°ëŠ¥ ë‹¨ìœ„
- public API â†’ ì¸í„°í˜ì´ìŠ¤ ì •ì˜

ë‚œì´ë„: ë‚®ìŒ
ì •í™•ë„: ë†’ìŒ
ìë™í™”: 100% ê°€ëŠ¥
```

**ì˜ˆì‹œ ì¶œë ¥**:

```yaml
# .sdd/domains.yml (ìë™ ìƒì„±)
domains:
  auth:
    name: "auth"
    inferred_from: "src/auth/"
    files: 3
    exports:
      - AuthService
      - LoginController
      - TokenRepository

  order:
    name: "order"
    inferred_from: "src/order/"
    files: 2
    exports:
      - OrderService
      - PaymentAdapter
```

### Level 2: ì¸í„°í˜ì´ìŠ¤ ì¶”ì¶œ (Interface)

```
ì¶”ì¶œ ëŒ€ìƒ:
- í´ë˜ìŠ¤/í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜
- ì…ì¶œë ¥ íƒ€ì…
- ì˜ì¡´ì„± ê´€ê³„
- ì—ëŸ¬ íƒ€ì…

ë‚œì´ë„: ì¤‘ê°„
ì •í™•ë„: ë†’ìŒ
ìë™í™”: 90% ê°€ëŠ¥ (íƒ€ì… ì •ë³´ ìˆì„ ê²½ìš°)
```

**ì˜ˆì‹œ ì¶œë ¥**:

```markdown
<!-- spec.md ì´ˆì•ˆ -->
# User Authentication

## ì¶”ì¶œëœ ì¸í„°í˜ì´ìŠ¤

### AuthService

| ë©”ì„œë“œ | ì…ë ¥ | ì¶œë ¥ | ì„¤ëª… |
|--------|------|------|------|
| `login` | `email: string, password: string` | `Promise<Session>` | (ì¶”ë¡  í•„ìš”) |
| `logout` | `sessionId: string` | `Promise<void>` | (ì¶”ë¡  í•„ìš”) |
| `verify` | `token: string` | `Promise<User \| null>` | (ì¶”ë¡  í•„ìš”) |

### ì˜ì¡´ì„±
- `TokenRepository` (ì§ì ‘)
- `UserRepository` (ì§ì ‘)
- `bcrypt` (ì™¸ë¶€)
```

### Level 3: ë™ì‘ ì¶”ì¶œ (Behavior)

```
ì¶”ì¶œ ëŒ€ìƒ:
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ íŒ¨í„´
- ì¡°ê±´ë¬¸/ë¶„ê¸° â†’ ê·œì¹™
- ì—ëŸ¬ ì²˜ë¦¬ â†’ ì˜ˆì™¸ ì¼€ì´ìŠ¤
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ â†’ ì‹œë‚˜ë¦¬ì˜¤

ë‚œì´ë„: ë†’ìŒ
ì •í™•ë„: ì¤‘ê°„ (AI ë³´ì¡° í•„ìš”)
ìë™í™”: 60-70%
```

**ì˜ˆì‹œ ì¶œë ¥**:

```markdown
## ì¶”ë¡ ëœ ìš”êµ¬ì‚¬í•­

### REQ-001: ë¡œê·¸ì¸ (ì¶”ë¡ ë¨)
- ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ì¸ì¦
- ë¹„ë°€ë²ˆí˜¸ëŠ” bcryptë¡œ ê²€ì¦ (ì½”ë“œì—ì„œ í™•ì¸)
- ì„±ê³µ ì‹œ Session ë°˜í™˜
- ì‹¤íŒ¨ ì‹œ AuthenticationError throw

### REQ-002: ì„¸ì…˜ ê²€ì¦ (ì¶”ë¡ ë¨)
- JWT í† í° ê²€ì¦
- ë§Œë£Œëœ í† í°ì€ null ë°˜í™˜
- ìœ íš¨í•œ í† í°ì€ User ê°ì²´ ë°˜í™˜

## ì¶”ë¡ ëœ ì‹œë‚˜ë¦¬ì˜¤

### SCENARIO-001: ì •ìƒ ë¡œê·¸ì¸ (í…ŒìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ)
```gherkin
GIVEN ìœ íš¨í•œ ì´ë©”ì¼ "user@example.com"
AND ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ "password123"
WHEN login() í˜¸ì¶œ
THEN Session ê°ì²´ ë°˜í™˜
AND Session.userIdê°€ í•´ë‹¹ ì‚¬ìš©ì ID
```

### SCENARIO-002: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ (í…ŒìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ)
```gherkin
GIVEN ìœ íš¨í•œ ì´ë©”ì¼ "user@example.com"
AND ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ "wrong"
WHEN login() í˜¸ì¶œ
THEN AuthenticationError throw
```
```

### Level 4: ì˜ë„ ì¶”ì¶œ (Intent) - AI í•„ìˆ˜

```
ì¶”ì¶œ ëŒ€ìƒ:
- "ì™œ ì´ë ‡ê²Œ êµ¬í˜„í–ˆëŠ”ê°€"
- ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸
- ì•”ë¬µì  ê·œì¹™
- ì£¼ì„/ë¬¸ì„œì—ì„œ íŒíŠ¸

ë‚œì´ë„: ë§¤ìš° ë†’ìŒ
ì •í™•ë„: ë‚®ìŒ-ì¤‘ê°„ (ë°˜ë“œì‹œ ê²€í†  í•„ìš”)
ìë™í™”: 40-50% (AI ë³´ì¡°)
```

**ì˜ˆì‹œ ì¶œë ¥**:

```markdown
## ì¶”ë¡ ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ (ê²€í†  í•„ìš”)

### ì¸ì¦ ì •ì±… (AI ì¶”ë¡ )
> âš ï¸ AIê°€ ì½”ë“œì™€ ì£¼ì„ì—ì„œ ì¶”ë¡ í•œ ë‚´ìš©ì…ë‹ˆë‹¤. ë°˜ë“œì‹œ ê²€í† í•˜ì„¸ìš”.

- ì„¸ì…˜ ë§Œë£Œ: 24ì‹œê°„ (ì½”ë“œì—ì„œ `24 * 60 * 60 * 1000` ë°œê²¬)
- Remember Me: 30ì¼ ì—°ì¥ (ì£¼ì„ "extend to 30 days if remember" ë°œê²¬)
- ë™ì‹œ ì„¸ì…˜: ì œí•œ ì—†ìŒ (ê´€ë ¨ ë¡œì§ ë¯¸ë°œê²¬)

### ë³´ì•ˆ ìš”êµ¬ì‚¬í•­ (AI ì¶”ë¡ )
- ë¹„ë°€ë²ˆí˜¸ í•´ì‹±: bcrypt, rounds=10
- í† í° ì•Œê³ ë¦¬ì¦˜: HS256 (jsonwebtoken ì„¤ì •)
- Rate limiting: ë¯¸êµ¬í˜„ (ê´€ë ¨ ì½”ë“œ ì—†ìŒ)
```

---

## ê¸°ìˆ  êµ¬í˜„ (Serena MCP ê¸°ë°˜)

### ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    sdd reverse extract                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   SDD Tool (ìš°ë¦¬ê°€ êµ¬í˜„)              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚  File Scannerâ”‚  â”‚  Test Parser â”‚  â† ê°„ë‹¨í•œ íŒŒì‹±   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Serena MCP (ì™¸ë¶€ - í•µì‹¬ ë¶„ì„)            â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â€¢ find_symbol          â†’ ì‹¬ë³¼ ì¶”ì¶œ                  â”‚   â”‚
â”‚  â”‚  â€¢ find_referencing_symbols â†’ ì°¸ì¡° ë¶„ì„             â”‚   â”‚
â”‚  â”‚  â€¢ get_symbol_definition â†’ ì •ì˜ ì¡°íšŒ                â”‚   â”‚
â”‚  â”‚  â€¢ 30ê°œ+ ì–¸ì–´ ìë™ ì§€ì›                              â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              SDD Tool (ìš°ë¦¬ê°€ êµ¬í˜„)                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              Spec Generator                     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Serena ê²°ê³¼ â†’ ë„ë©”ì¸ êµ¬ì¡° ë³€í™˜              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ìŠ¤í™ í…œí”Œë¦¿ ì ìš©                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ì‹ ë¢°ë„ ê³„ì‚°                                 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              AI Analyzer (Claude)              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ì˜ë„ ì¶”ë¡                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì¶”ì¶œ                          â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚              Review Workflow                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ ê²€í†  CLI                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ í™•ì • í”„ë¡œì„¸ìŠ¤                               â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê°œë°œ ë²”ìœ„ ë³€ê²½

**ì§ì ‘ êµ¬í˜„ (ìµœì†Œí™”)**:
```
â–¡ File Scanner - ë””ë ‰í† ë¦¬/íŒŒì¼ ëª©ë¡ (ê°„ë‹¨)
â–¡ Test Parser - describe/it êµ¬ì¡°ë§Œ (ê°„ë‹¨)
â–¡ Serena Client - MCP í˜¸ì¶œ ë˜í¼ (ê°„ë‹¨)
â–¡ Spec Generator - í…œí”Œë¦¿ ì ìš© (í•µì‹¬)
â–¡ Review Workflow - CLI ì¸í„°ë™ì…˜ (í•µì‹¬)
```

**Serenaì— ìœ„ì„ (ë³µì¡í•œ ë¶€ë¶„)**:
```
âœ… AST íŒŒì‹± - 30ê°œ+ ì–¸ì–´
âœ… ì‹¬ë³¼ ì¶”ì¶œ - í´ë˜ìŠ¤, í•¨ìˆ˜, ë³€ìˆ˜
âœ… ì°¸ì¡° ë¶„ì„ - ì˜ì¡´ì„± ê·¸ë˜í”„
âœ… íƒ€ì… ì •ë³´ - ì‹œê·¸ë‹ˆì²˜, íŒŒë¼ë¯¸í„°
```

### ì§€ì› ì–¸ì–´

| ì–¸ì–´ | Serena ì§€ì› | ì¶”ê°€ êµ¬í˜„ | ë¹„ê³  |
|------|-------------|-----------|------|
| TypeScript | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| JavaScript | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| Python | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| Go | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| Java | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| Rust | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| C/C++ | âœ… | ì—†ìŒ | ì¦‰ì‹œ ì‚¬ìš© |
| ... | âœ… | ì—†ìŒ | 30ê°œ+ ì–¸ì–´ |

**ê²°ë¡ **: ì–¸ì–´ë³„ íŒŒì„œ êµ¬í˜„ ë¶ˆí•„ìš”

### í•µì‹¬ ëª¨ë“ˆ

#### 1. File Scanner

```typescript
// src/core/reverse/scanner.ts
interface ScanResult {
  root: string;
  files: FileInfo[];
  structure: DirectoryTree;
  languages: LanguageStats;
  entryPoints: string[];
}

interface FileInfo {
  path: string;
  language: Language;
  size: number;
  exports: string[];
  imports: ImportInfo[];
}
```

#### 2. AST Parser (TypeScript ì˜ˆì‹œ)

```typescript
// src/core/reverse/parsers/typescript.ts
interface ParseResult {
  classes: ClassInfo[];
  functions: FunctionInfo[];
  interfaces: InterfaceInfo[];
  types: TypeInfo[];
  dependencies: DependencyInfo[];
}

interface ClassInfo {
  name: string;
  file: string;
  methods: MethodInfo[];
  properties: PropertyInfo[];
  extends?: string;
  implements: string[];
  decorators: string[];
  jsdoc?: string;
}

interface MethodInfo {
  name: string;
  visibility: 'public' | 'private' | 'protected';
  async: boolean;
  parameters: ParameterInfo[];
  returnType: string;
  jsdoc?: string;
  body?: string;  // AI ë¶„ì„ìš©
}
```

#### 3. Test Parser

```typescript
// src/core/reverse/parsers/test-parser.ts
interface TestParseResult {
  suites: TestSuite[];
  scenarios: ExtractedScenario[];
}

interface TestSuite {
  name: string;
  file: string;
  tests: TestCase[];
}

interface TestCase {
  name: string;
  type: 'unit' | 'integration' | 'e2e';
  assertions: Assertion[];
  // GIVEN-WHEN-THEN ì¶”ë¡ 
  given?: string;
  when?: string;
  then?: string;
}
```

#### 4. AI Analyzer

```typescript
// src/core/reverse/ai-analyzer.ts
interface AIAnalysisRequest {
  code: string;
  context: {
    file: string;
    className?: string;
    methodName?: string;
    relatedCode?: string[];
  };
  prompt: 'intent' | 'requirements' | 'scenarios' | 'rules';
}

interface AIAnalysisResult {
  content: string;
  confidence: number;  // 0-100
  sources: string[];   // ì¶”ë¡  ê·¼ê±°
  needsReview: boolean;
}
```

#### 5. Spec Generator

```typescript
// src/core/reverse/generator.ts
interface GeneratorOptions {
  depth: 'shallow' | 'medium' | 'deep';
  includeAI: boolean;
  outputFormat: 'markdown' | 'yaml';
  reviewMode: boolean;  // ê²€í†  í•„ìš” í‘œì‹œ
}

interface GeneratedSpec {
  domain: DomainSpec;
  features: FeatureSpec[];
  confidence: ConfidenceReport;
  reviewItems: ReviewItem[];
}

interface ConfidenceReport {
  overall: number;
  bySection: {
    structure: number;
    interfaces: number;
    requirements: number;
    scenarios: number;
  };
}

interface ReviewItem {
  location: string;
  type: 'verify' | 'complete' | 'clarify';
  message: string;
  suggestion?: string;
}
```

---

## ì¶œë ¥ í˜•ì‹

### ìŠ¤í™ ì´ˆì•ˆ í…œí”Œë¦¿

```markdown
<!-- .sdd/specs/auth/user-authentication/spec.md -->
---
id: auth/user-authentication
status: draft
source: reverse-extracted
extracted_from:
  - src/auth/AuthService.ts
  - src/auth/LoginController.ts
extraction_date: 2024-12-24
confidence: 72
needs_review: true
---

# User Authentication

> âš ï¸ **ìë™ ì¶”ì¶œëœ ìŠ¤í™**: ì´ ë¬¸ì„œëŠ” ì½”ë“œì—ì„œ ìë™ ì¶”ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.
> ë°˜ë“œì‹œ ê²€í† í•˜ê³  ëˆ„ë½ëœ ë‚´ìš©ì„ ë³´ì™„í•˜ì„¸ìš”.

## ê°œìš”

<!-- AI ì¶”ë¡  ë˜ëŠ” ì£¼ì„ì—ì„œ ì¶”ì¶œ -->
ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.

**ì¶”ì¶œ ì‹ ë¢°ë„**: 72% (ê²€í†  í•„ìš”)

## ì¶”ì¶œëœ ì¸í„°í˜ì´ìŠ¤

### AuthService

| ë©”ì„œë“œ | ì‹œê·¸ë‹ˆì²˜ | ì‹ ë¢°ë„ |
|--------|----------|--------|
| login | `(email: string, password: string) => Promise<Session>` | 100% |
| logout | `(sessionId: string) => Promise<void>` | 100% |
| verify | `(token: string) => Promise<User \| null>` | 100% |

### ì˜ì¡´ì„±

- âœ… `TokenRepository` - í™•ì¸ë¨
- âœ… `UserRepository` - í™•ì¸ë¨
- âš ï¸ `EmailService` - ì¶”ë¡ ë¨ (ê²€í†  í•„ìš”)

## ìš”êµ¬ì‚¬í•­ (ì¶”ë¡ ë¨)

> âš ï¸ ì½”ë“œì—ì„œ ì¶”ë¡ í•œ ìš”êµ¬ì‚¬í•­ì…ë‹ˆë‹¤. ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë„ì™€ ë§ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.

### REQ-001: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ [ì‹ ë¢°ë„: 85%]

ì‚¬ìš©ìëŠ” ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

**ê·¼ê±°**:
- `AuthService.login(email, password)` ì‹œê·¸ë‹ˆì²˜
- bcrypt ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§ ì¡´ì¬

**ê²€í†  í•„ìš”**:
- [ ] ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ ê·œì¹™ í™•ì¸
- [ ] ë¹„ë°€ë²ˆí˜¸ ë³µì¡ë„ ê·œì¹™ í™•ì¸

### REQ-002: JWT í† í° ë°œê¸‰ [ì‹ ë¢°ë„: 90%]

ë¡œê·¸ì¸ ì„±ê³µ ì‹œ JWT í† í°ì„ ë°œê¸‰í•´ì•¼ í•œë‹¤.

**ê·¼ê±°**:
- jsonwebtoken íŒ¨í‚¤ì§€ ì‚¬ìš©
- `TokenRepository.create()` í˜¸ì¶œ

### REQ-003: ì„¸ì…˜ ë§Œë£Œ [ì‹ ë¢°ë„: 70%]

ì„¸ì…˜ì€ 24ì‹œê°„ í›„ ë§Œë£Œë˜ì–´ì•¼ í•œë‹¤.

**ê·¼ê±°**:
- ì½”ë“œ: `expiresIn: 24 * 60 * 60 * 1000`

**ê²€í†  í•„ìš”**:
- [ ] 24ì‹œê°„ì´ ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
- [ ] Remember Me ê¸°ëŠ¥ ì—¬ë¶€ í™•ì¸

## ì‹œë‚˜ë¦¬ì˜¤ (í…ŒìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ)

### SCENARIO-001: ì •ìƒ ë¡œê·¸ì¸ [ì‹ ë¢°ë„: 95%]

**ì¶œì²˜**: `tests/auth/login.test.ts:15`

```gherkin
GIVEN ë“±ë¡ëœ ì‚¬ìš©ì "user@example.com"
AND ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ "ValidPass123"
WHEN ë¡œê·¸ì¸ ì‹œë„
THEN ì„¸ì…˜ í† í° ë°˜í™˜
AND ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ì„¤ì •ë¨
```

### SCENARIO-002: ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ [ì‹ ë¢°ë„: 95%]

**ì¶œì²˜**: `tests/auth/login.test.ts:28`

```gherkin
GIVEN ë“±ë¡ëœ ì‚¬ìš©ì "user@example.com"
AND ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ "wrong"
WHEN ë¡œê·¸ì¸ ì‹œë„
THEN AuthenticationError ë°œìƒ
AND ì—ëŸ¬ ë©”ì‹œì§€ "Invalid credentials"
```

### SCENARIO-003: ë¯¸ë“±ë¡ ì‚¬ìš©ì [ì‹ ë¢°ë„: 90%]

**ì¶œì²˜**: `tests/auth/login.test.ts:41`

```gherkin
GIVEN ë¯¸ë“±ë¡ ì´ë©”ì¼ "unknown@example.com"
WHEN ë¡œê·¸ì¸ ì‹œë„
THEN UserNotFoundError ë°œìƒ
```

## ëˆ„ë½ ê°€ëŠ¥ì„± (ê²€í†  í•„ìš”)

> ë‹¤ìŒ í•­ëª©ë“¤ì€ ì½”ë“œì—ì„œ ëª…í™•íˆ í™•ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

- [ ] **Rate Limiting**: ë¡œê·¸ì¸ ì‹œë„ ì œí•œ ë¡œì§ ë¯¸ë°œê²¬
- [ ] **Account Lockout**: ì—°ì† ì‹¤íŒ¨ ì‹œ ê³„ì • ì ê¸ˆ ë¯¸ë°œê²¬
- [ ] **Password Reset**: ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í”Œë¡œìš° ë¯¸ë°œê²¬
- [ ] **2FA/MFA**: ë‹¤ì¤‘ ì¸ì¦ ë¡œì§ ë¯¸ë°œê²¬

## ì½”ë“œ ë§í¬

```yaml
code_links:
  implements:
    - src/auth/AuthService.ts
    - src/auth/LoginController.ts
  tests:
    - tests/auth/login.test.ts
    - tests/auth/session.test.ts
  related:
    - src/auth/TokenRepository.ts
    - src/core/User.ts
```

---

## ì¶”ì¶œ ë©”íƒ€ë°ì´í„°

```json
// .reverse-meta.json
{
  "extracted_at": "2024-12-24T10:30:00Z",
  "tool_version": "2.0.0",
  "source_files": [
    "src/auth/AuthService.ts",
    "src/auth/LoginController.ts"
  ],
  "test_files": [
    "tests/auth/login.test.ts"
  ],
  "analysis_depth": "deep",
  "ai_assisted": true,
  "confidence_scores": {
    "structure": 100,
    "interfaces": 95,
    "requirements": 72,
    "scenarios": 88
  },
  "review_status": "pending",
  "reviewed_by": null,
  "reviewed_at": null
}
```
```

---

## ì›Œí¬í”Œë¡œìš°

### 1ë‹¨ê³„: ìŠ¤ìº”

```bash
$ sdd reverse scan

ğŸ” ì½”ë“œë² ì´ìŠ¤ ìŠ¤ìº” ì¤‘...

ë°œê²¬ëœ êµ¬ì¡°:
  ğŸ“ src/
  â”œâ”€â”€ ğŸ“ auth/ (3 files, 450 LOC)
  â”‚   â”œâ”€â”€ AuthService.ts
  â”‚   â”œâ”€â”€ LoginController.ts
  â”‚   â””â”€â”€ TokenRepository.ts
  â”œâ”€â”€ ğŸ“ order/ (5 files, 890 LOC)
  â”‚   â””â”€â”€ ...
  â””â”€â”€ ğŸ“ core/ (8 files, 1200 LOC)
      â””â”€â”€ ...

ğŸ“Š ìš”ì•½:
  - ì–¸ì–´: TypeScript (100%)
  - íŒŒì¼: 16ê°œ
  - LOC: 2,540
  - í…ŒìŠ¤íŠ¸: 12ê°œ íŒŒì¼

ğŸ’¡ ì¶”ì²œ ë„ë©”ì¸:
  1. auth (3 files) - ì¸ì¦ ê´€ë ¨ ì¶”ì •
  2. order (5 files) - ì£¼ë¬¸ ê´€ë ¨ ì¶”ì •
  3. core (8 files) - ê³µí†µ ëª¨ë“ˆ ì¶”ì •

ê³„ì†í•˜ë ¤ë©´ 'sdd reverse extract' ì‹¤í–‰
```

### 2ë‹¨ê³„: ì¶”ì¶œ

```bash
$ sdd reverse extract --depth deep --ai

ğŸ”„ ìŠ¤í™ ì¶”ì¶œ ì¤‘...

[1/3] auth ë„ë©”ì¸ ë¶„ì„...
  â”œâ”€â”€ êµ¬ì¡° ë¶„ì„... âœ…
  â”œâ”€â”€ ì¸í„°í˜ì´ìŠ¤ ì¶”ì¶œ... âœ…
  â”œâ”€â”€ í…ŒìŠ¤íŠ¸ ë¶„ì„... âœ… (8 scenarios)
  â””â”€â”€ AI ì˜ë„ ì¶”ë¡ ... âœ…

[2/3] order ë„ë©”ì¸ ë¶„ì„...
  â””â”€â”€ ...

[3/3] core ë„ë©”ì¸ ë¶„ì„...
  â””â”€â”€ ...

ğŸ“ ìƒì„±ëœ ìŠ¤í™:
  .sdd/
  â”œâ”€â”€ domains.yml
  â””â”€â”€ specs/
      â”œâ”€â”€ auth/
      â”‚   â”œâ”€â”€ domain.md
      â”‚   â””â”€â”€ user-authentication/
      â”‚       â””â”€â”€ spec.md (ì‹ ë¢°ë„: 72%)
      â”œâ”€â”€ order/
      â”‚   â””â”€â”€ ...
      â””â”€â”€ core/
          â””â”€â”€ ...

âš ï¸ ê²€í†  í•„ìš” í•­ëª©: 12ê°œ
  - auth/user-authentication: 5ê°œ
  - order/checkout: 4ê°œ
  - core/user-model: 3ê°œ

ë‹¤ìŒ ë‹¨ê³„: 'sdd reverse review' ë¡œ ê²€í†  ì‹œì‘
```

### 3ë‹¨ê³„: ê²€í† 

```bash
$ sdd reverse review

ğŸ“‹ ê²€í†  ëŒ€ê¸° ìŠ¤í™: 6ê°œ

[1/6] auth/user-authentication (ì‹ ë¢°ë„: 72%)

ê²€í†  í•­ëª©:
  1. REQ-003: ì„¸ì…˜ ë§Œë£Œ 24ì‹œê°„ - ë§ìŠµë‹ˆê¹Œ? (y/n/edit)
  > y

  2. Rate Limiting ë¯¸ë°œê²¬ - ì˜ë„ì  ëˆ„ë½ì…ë‹ˆê¹Œ? (y/n/add)
  > add
  > ì„¤ëª… ì…ë ¥: ë¡œê·¸ì¸ 5íšŒ ì‹¤íŒ¨ ì‹œ 10ë¶„ ì ê¸ˆ

  3. 2FA ë¯¸ë°œê²¬ - ì˜ë„ì  ëˆ„ë½ì…ë‹ˆê¹Œ? (y/n/add)
  > y (í˜„ì¬ ë¯¸ì§€ì›)

âœ… auth/user-authentication ê²€í†  ì™„ë£Œ
   ì‹ ë¢°ë„: 72% â†’ 95% (ê²€í† ë¨)

[2/6] ë‹¤ìŒ ìŠ¤í™...
```

### 4ë‹¨ê³„: í™•ì •

```bash
$ sdd reverse finalize

âœ… ê²€í†  ì™„ë£Œëœ ìŠ¤í™:
  - auth/user-authentication (95%)
  - auth/token-management (88%)
  - order/checkout (91%)

âš ï¸ ê²€í†  ë¯¸ì™„ë£Œ:
  - order/payment (ê²€í†  í•„ìš”)
  - core/user-model (ê²€í†  í•„ìš”)

í™•ì •ëœ ìŠ¤í™ì„ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)
> y

ğŸ“ ìŠ¤í™ í™•ì • ì™„ë£Œ
  - status: draft â†’ extracted
  - needs_review: true â†’ false

ë‹¤ìŒ ë‹¨ê³„:
  1. 'sdd validate' ë¡œ ìŠ¤í™ ê²€ì¦
  2. í•„ìš”ì‹œ ìˆ˜ë™ ë³´ì™„
  3. 'sdd status' ë¡œ ì§„í–‰ ìƒí™© í™•ì¸
```

---

## AI ì—°ë™ ì „ëµ

### í”„ë¡¬í”„íŠ¸ ì„¤ê³„

#### ì˜ë„ ì¶”ë¡  í”„ë¡¬í”„íŠ¸

```markdown
ë‹¤ìŒ TypeScript ì½”ë“œë¥¼ ë¶„ì„í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë„ë¥¼ ì¶”ë¡ í•˜ì„¸ìš”.

## ì½”ë“œ
```typescript
{code}
```

## ì»¨í…ìŠ¤íŠ¸
- íŒŒì¼: {file_path}
- í´ë˜ìŠ¤: {class_name}
- ê´€ë ¨ ì½”ë“œ: {related_files}

## ìš”ì²­
1. ì´ ì½”ë“œì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ëª©ì ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?
2. ì–´ë–¤ ìš”êµ¬ì‚¬í•­ì„ êµ¬í˜„í•œ ê²ƒì…ë‹ˆê¹Œ?
3. ì•”ë¬µì ìœ¼ë¡œ ê°€ì •í•˜ëŠ” ê·œì¹™ì´ ìˆìŠµë‹ˆê¹Œ?

## ì¶œë ¥ í˜•ì‹
- ìš”êµ¬ì‚¬í•­ì„ RFC 2119 í‚¤ì›Œë“œ(MUST, SHOULD, MAY)ë¡œ ì‘ì„±
- í™•ì‹  ìˆ˜ì¤€ì„ 0-100ìœ¼ë¡œ í‘œì‹œ
- ì¶”ë¡  ê·¼ê±°ë¥¼ ëª…ì‹œ
```

#### ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± í”„ë¡¬í”„íŠ¸

```markdown
ë‹¤ìŒ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ GIVEN-WHEN-THEN ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë³€í™˜í•˜ì„¸ìš”.

## í…ŒìŠ¤íŠ¸ ì½”ë“œ
```typescript
{test_code}
```

## ì¶œë ¥ í˜•ì‹
```gherkin
GIVEN [ì‚¬ì „ ì¡°ê±´]
AND [ì¶”ê°€ ì¡°ê±´]
WHEN [ë™ì‘]
THEN [ê²°ê³¼]
AND [ì¶”ê°€ ê²€ì¦]
```

## ê·œì¹™
- ê¸°ìˆ  ìš©ì–´ë³´ë‹¤ ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ ì‚¬ìš©
- êµ¬ì²´ì ì¸ ê°’ë³´ë‹¤ ì˜ë¯¸ ìˆëŠ” ì„¤ëª… ì‚¬ìš©
- í…ŒìŠ¤íŠ¸ê°€ ê²€ì¦í•˜ëŠ” í•µì‹¬ ë™ì‘ì— ì§‘ì¤‘
```

### ë¹„ìš© ìµœì í™”

```yaml
ai_strategy:
  # ë¬´ì¡°ê±´ AI ì‚¬ìš©
  always_ai:
    - intent_inference
    - business_rule_extraction

  # íœ´ë¦¬ìŠ¤í‹± ì‹¤íŒ¨ ì‹œì—ë§Œ AI
  fallback_ai:
    - requirement_extraction
    - scenario_enhancement

  # AI ì‚¬ìš© ì•ˆ í•¨
  no_ai:
    - structure_analysis
    - interface_extraction
    - test_parsing

  # í† í° ì œí•œ
  limits:
    max_tokens_per_file: 4000
    max_files_per_batch: 10
    cache_results: true
```

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„ (Serena ê¸°ë°˜ - ëŒ€í­ ê°„ì†Œí™”)

### ê°œë°œ ê¸°ê°„ ë¹„êµ

| í•­ëª© | ì§ì ‘ êµ¬í˜„ | Serena í™œìš© |
|------|----------|-------------|
| Phase 1 (êµ¬ì¡°) | 4-6ì£¼ | 1-2ì£¼ |
| Phase 2 (ì¸í„°í˜ì´ìŠ¤) | 4-6ì£¼ | 1-2ì£¼ |
| Phase 3 (AI ë¶„ì„) | 2-3ì£¼ | 2-3ì£¼ (ë™ì¼) |
| Phase 4 (ì¶”ê°€ ì–¸ì–´) | 6-8ì£¼ | 0ì£¼ (ë¶ˆí•„ìš”) |
| **ì´í•©** | **16-23ì£¼** | **4-7ì£¼** |

### Phase 1: Serena í†µí•© + êµ¬ì¡° ì¶”ì¶œ (MVP)

```
â–¡ Serena MCP í†µí•©
  â–¡ MCP í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
  â–¡ find_symbol ë˜í•‘
  â–¡ find_referencing_symbols ë˜í•‘
  â–¡ ì—°ê²° í…ŒìŠ¤íŠ¸

â–¡ File Scanner (ê°„ë‹¨)
  â–¡ ë””ë ‰í† ë¦¬ íŠ¸ë¦¬ ìƒì„±
  â–¡ íŒŒì¼ ëª©ë¡ (ì–¸ì–´ ê°ì§€ëŠ” Serena)

â–¡ Spec Generator (ê¸°ë³¸)
  â–¡ Serena ê²°ê³¼ â†’ domains.yml ë³€í™˜
  â–¡ domain.md í…œí”Œë¦¿
  â–¡ ê¸°ë³¸ spec.md ìƒì„±

â–¡ CLI
  â–¡ sdd reverse scan
  â–¡ sdd reverse extract --shallow
```

**ì˜ˆìƒ ê¸°ê°„**: 1-2ì£¼
**ëª©í‘œ**: Serenaë¡œ ì‹¬ë³¼ ì¶”ì¶œ â†’ ë„ë©”ì¸/ìŠ¤í™ êµ¬ì¡° ìë™ ìƒì„±

### Phase 2: ìƒì„¸ ì¶”ì¶œ + í…ŒìŠ¤íŠ¸ ì—°ë™

```
â–¡ Serena ì‹¬í™” í™œìš©
  â–¡ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ìƒì„¸ ì¶”ì¶œ
  â–¡ ì°¸ì¡° ê´€ê³„ â†’ ì˜ì¡´ì„± ê·¸ë˜í”„
  â–¡ ì—ëŸ¬ íƒ€ì… ì¶”ì¶œ

â–¡ í…ŒìŠ¤íŠ¸ íŒŒì„œ (ê°„ë‹¨ - êµ¬ì¡°ë§Œ)
  â–¡ describe/it ë¸”ë¡ íŒŒì‹±
  â–¡ í…ŒìŠ¤íŠ¸ëª… â†’ ì‹œë‚˜ë¦¬ì˜¤ íŒíŠ¸
  â–¡ GIVEN-WHEN-THEN ì¶”ë¡  (AI)

â–¡ ì½”ë“œ ë§í¬ ìë™í™”
  â–¡ spec â†” code ìë™ ì—°ê²°
  â–¡ .reverse-meta.json ìƒì„±
```

**ì˜ˆìƒ ê¸°ê°„**: 1-2ì£¼
**ëª©í‘œ**: ìƒì„¸ ì¸í„°í˜ì´ìŠ¤ + í…ŒìŠ¤íŠ¸ ê¸°ë°˜ ì‹œë‚˜ë¦¬ì˜¤

### Phase 3: AI ë¶„ì„ + ê²€í†  ì›Œí¬í”Œë¡œìš°

```
â–¡ Claude ì—°ë™ ë¶„ì„
  â–¡ ì˜ë„ ì¶”ë¡  í”„ë¡¬í”„íŠ¸
  â–¡ ìš”êµ¬ì‚¬í•­ ìƒì„± í”„ë¡¬í”„íŠ¸
  â–¡ ì‹œë‚˜ë¦¬ì˜¤ ë³´ê°• í”„ë¡¬í”„íŠ¸

â–¡ ì‹ ë¢°ë„ ì‹œìŠ¤í…œ
  â–¡ ì„¹ì…˜ë³„ ì‹ ë¢°ë„ ê³„ì‚°
  â–¡ ê²€í†  í•„ìš” í•­ëª© ìë™ í‘œì‹œ

â–¡ ê²€í†  ì›Œí¬í”Œë¡œìš°
  â–¡ sdd reverse review (ì¸í„°ë™í‹°ë¸Œ)
  â–¡ sdd reverse finalize
  â–¡ ìƒíƒœ ì „í™˜ (extracted â†’ draft)
```

**ì˜ˆìƒ ê¸°ê°„**: 2-3ì£¼
**ëª©í‘œ**: AI ì˜ë„ ì¶”ë¡  + ì¸ê°„ ê²€í†  ì™„ì„±

### Phase 4: ~~ì¶”ê°€ ì–¸ì–´ ì§€ì›~~ â†’ ì‚­ì œ

```
âœ… Serenaê°€ 30ê°œ+ ì–¸ì–´ ì§€ì›
âœ… ì¶”ê°€ êµ¬í˜„ ë¶ˆí•„ìš”
âœ… Phase 4 ì‚­ì œë¨
```

**ì˜ˆìƒ ê¸°ê°„**: 0ì£¼
**ì´ìœ **: Serenaê°€ ì´ë¯¸ ì²˜ë¦¬

---

## ì„±ê³µ ì§€í‘œ

### ì •ëŸ‰ ì§€í‘œ

```
- êµ¬ì¡° ì¶”ì¶œ ì •í™•ë„: > 95%
- ì¸í„°í˜ì´ìŠ¤ ì¶”ì¶œ ì •í™•ë„: > 90%
- í…ŒìŠ¤íŠ¸ â†’ ì‹œë‚˜ë¦¬ì˜¤ ë³€í™˜ìœ¨: > 80%
- AI ìš”êµ¬ì‚¬í•­ ì¶”ë¡  ì •í™•ë„: > 70%
- ê²€í†  í›„ ìµœì¢… ì •í™•ë„: > 95%
```

### ì •ì„± ì§€í‘œ

```
- "ìŠ¤í™ ì‘ì„± ì‹œê°„ 50% ì´ìƒ ë‹¨ì¶•"
- "ë ˆê±°ì‹œ í”„ë¡œì íŠ¸ SDD ë„ì… ê°€ëŠ¥"
- "ê¸°ì¡´ ì½”ë“œ ì´í•´ë„ í–¥ìƒ"
```

---

## ë¦¬ìŠ¤í¬ ë° ì™„í™”

### Serena ê´€ë ¨ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | ì™„í™” ë°©ì•ˆ |
|--------|------|-----------|
| Serena í”„ë¡œì íŠ¸ ì¤‘ë‹¨ | ë†’ìŒ | ì¶”ìƒí™” ë ˆì´ì–´ë¡œ êµì²´ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„ |
| Serena API ë³€ê²½ | ì¤‘ê°„ | ë²„ì „ ê³ ì • + ë˜í¼ ë ˆì´ì–´ |
| MCP ì—°ê²° ì‹¤íŒ¨ | ì¤‘ê°„ | í´ë°± ëª¨ë“œ (ê¸°ë³¸ íŒŒì„œ) ì œê³µ |
| Serena ë¯¸ì„¤ì¹˜ í™˜ê²½ | ì¤‘ê°„ | ì„¤ì¹˜ ê°€ì´ë“œ + ìë™ ê°ì§€ |

**ì™„í™” ì „ëµ: ì¶”ìƒí™” ë ˆì´ì–´**

```typescript
// src/core/reverse/analyzer.ts
interface CodeAnalyzer {
  findSymbols(query: string): Promise<Symbol[]>;
  findReferences(symbol: string): Promise<Reference[]>;
  getDefinition(symbol: string): Promise<Definition>;
}

// Serena êµ¬í˜„
class SerenaAnalyzer implements CodeAnalyzer { ... }

// í´ë°±: ê¸°ë³¸ TS íŒŒì„œ (Serena ì—†ì„ ë•Œ)
class FallbackAnalyzer implements CodeAnalyzer { ... }
```

### ê¸°íƒ€ ë¦¬ìŠ¤í¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ | ì™„í™” ë°©ì•ˆ |
|--------|------|-----------|
| AI ì¶”ë¡  ì˜¤ë¥˜ | ë†’ìŒ | ì‹ ë¢°ë„ í‘œì‹œ + í•„ìˆ˜ ê²€í†  |
| ë³µì¡í•œ ì½”ë“œ íŒ¨í„´ | ì¤‘ê°„ | Serenaê°€ ëŒ€ë¶€ë¶„ ì²˜ë¦¬ |
| ëŒ€ìš©ëŸ‰ ì½”ë“œë² ì´ìŠ¤ | ì¤‘ê°„ | ì²­í¬ ì²˜ë¦¬ + ìºì‹± |
| ë‹¤ì–‘í•œ ì½”ë”© ìŠ¤íƒ€ì¼ | ì¤‘ê°„ | Serenaê°€ ëŒ€ë¶€ë¶„ ì²˜ë¦¬ |
| í…ŒìŠ¤íŠ¸ ì—†ëŠ” ì½”ë“œ | ë†’ìŒ | ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜ë™ ì¶”ê°€ ìœ ë„ |

### Serena ì˜ì¡´ì„± í‰ê°€

```
ì¥ì :
âœ… ê°œë°œ ê¸°ê°„ 70% ë‹¨ì¶• (16-23ì£¼ â†’ 4-7ì£¼)
âœ… 30ê°œ+ ì–¸ì–´ ì¦‰ì‹œ ì§€ì›
âœ… IDE ìˆ˜ì¤€ ì •í™•ë„
âœ… ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´ ì—†ìŒ

ë‹¨ì :
âš ï¸ ì™¸ë¶€ ì˜ì¡´ì„± ì¶”ê°€
âš ï¸ MCP ì„¤ì • í•„ìš”
âš ï¸ Serena í”„ë¡œì íŠ¸ ì˜ì¡´

ê²°ë¡ :
â†’ ì¥ì ì´ ì••ë„ì ìœ¼ë¡œ í¼
â†’ ì¶”ìƒí™” ë ˆì´ì–´ë¡œ ë¦¬ìŠ¤í¬ ì™„í™” ê°€ëŠ¥
â†’ Serena í™œìš© ê¶Œì¥
```

---

## ê´€ë ¨ ë¬¸ì„œ

- [ë¡œë“œë§µ ê°œìš”](./overview.md) - Phase 2 ì½”ë“œ ì»¨í…ìŠ¤íŠ¸ ì—°ê²°ê³¼ ì—°ê³„
- [í˜„ì¬ í•œê³„ì ](./current-limits.md) - ë¸Œë¼ìš´í•„ë“œ ì§€ì› ê°•í™”
